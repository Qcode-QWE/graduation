<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../../lib/layui/css/layui.css" type="text/css"/>
    <script type="text/javascript" src="../../../lib/layui/layui.all.js"></script>
    <script type="text/javascript" src="../../../js/baseUtils.js"></script>
    <script type="text/javascript" src="../../../js/LawUtils.js"></script>
    <link rel="stylesheet" href="../../../css/xadmin.css">
    <script type="text/javascript" src="../../../js/xadmin.js"></script>
    <title>法律咨询</title>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="../../../js/html5shiv.min.js"></script>
    <script type="text/javascript" src="../../../js/respond.js"></script>
    <![endif]-->
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-col-md5">
            <h2>Local:</h2>
            <video id="localvideo" autoplay playsinline></video>
        </div>
        <div class="layui-col-md5">
            <h2>Remote:</h2>
            <video id="remotevideo" autoplay playsinline></video>
        </div>
        <div class="layui-col-md2">
            <div class="layui-form-item">
                <button class="layui-btn" lay-submit id="createRoom" lay-filter="createRoom">创建咨询信息</button>
                <button class="layui-btn" lay-submit id="connserver" lay-filter="connserver">Connect Sig Server</button>
                <button class="layui-btn" lay-submit id="leave" lay-filter="leave" disabled>Leave</button>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="barDemo">
    <a class="layui-btn  layui-btn-xs" lay-event="detail">查看留言记录</a>
    <!--<a class="layui-btn layui-btn-xs" lay-event="edit">回复</a>-->
    <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
<script src="../js/adapter-latest.js"></script>
<script src="../js/client.js"></script>

<script>
    <!--分页查询-->
    layui.use(['table', 'form', 'layer', 'jquery'], function () {
        var table = layui.table;
        var form = layui.form;   //只有执行了这一步，部分表单元素才会自动修饰成功
        var layer = layui.layer;
        var json = layui.json;
        $ = layui.jquery;
        form.render();       //手动渲染


        //监听工具条   回复留言
        table.on('tool(mytable)', function (obj) {
            var data = obj.data;
            var id = data.id;
            var uid = data.uid;
            var reply_mark = data.reply_mark;
            if (obj.event === 'detail') {
                toolWindow("查看留言记录", "law-help-view.html?tag=1&id=" + id + "&uid=" + uid + "&reply_mark=" + reply_mark + "", 1, tableResult);
            } else if (obj.event === 'del') {
                layer.confirm('真的删除么', function (index) {
                    obj.del();
                    Delete(data.id, index);
//                    layer.close(index);
                });
            } else if (obj.event === 'edit') { //编辑留言
//                layer.alert('编辑行：<br>'+ JSON.stringify(data))
                layer.prompt({
                    formType: 2
                    , title: '回复留言'
                    , value: ""
                }, function (value, index) {
                    //这里一般是发送修改的Ajax请求
                    Eidt(data, value, index, obj);
                });

            }
        });


        //删除留言
        function Delete(id, index) {
            $.ajax({
                url: path + "/law/help/delete.do",
                type: "POST",
                data: {"id": id},
                dataType: "json",
                success: function (data) {
                    if (data == 1) {
                        layer.close(index);
                        layer.msg("删除成功", {icon: 6});
                    }
                }
            });
        }

        function Eidt(data, value, index, obj) {
            $.ajax({
                url: path + "/law/help/edit.do",
                type: "POST",
                data: {
                    "id": data.id, "tag": data.tag, "content": value, "pid": data.pid, "to_user_id": data.to_user_id
                    , "from_user_id": data.from_user_id, "uid": data.uid
                },
                dataType: "json",
                success: function (data) {

                    if (data == 1) {
                        //关闭弹框
                        layer.close(index);
                        //同步更新表格和缓存对应的值
//                        obj.update({
//                            uv: value
//                        });
                        layer.msg("留言成功", {icon: 1});
                        var cur = $(".layui-laypage-em").next().html();//获取当前页
                        window.location.reload();
                    } else {
                        layer.msg("修改失败", {icon: 5});
                    }
                }

            });
        }

        //监听听select选择
        form.on('select(mySelect)', function (data) {
//            console.log(data.elem); ////得到select原始DOM对象
            console.log(data.value); ////得到被选中的值
            var reply_mark = data.value;
            tableResult.reload({
                url: path + '/law/help/list.do?tag=1',
                method: 'get',
                where: {
                    reply_mark: reply_mark,
                },
                page: {
                    curr: 1
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });

        //监控提交
        form.on('submit(createRoom)', function (data) {
            xadmin.open('添加咨询信息', './message-add.html', 700, 400);
        });

    });


</script>
<script id="createTime" type="text/html">
    {{#
    if (d.create_time!=0){
    var date = new Date();
    var createTime = d.create_time+"000";
    date.setTime(createTime);
    return date.Format("yyyy-MM-dd hh:mm:ss");
    }
    return '没有记录';
    }}
</script>
</body>
</html>