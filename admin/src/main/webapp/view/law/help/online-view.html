<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>查看留言记录</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="../../../lib/layui/css/layui.css" type="text/css"/>
    <link rel="stylesheet" href="../../../css/law-help-view.css" type="text/css">
    <script type="text/javascript" src="../../../lib/layui/layui.all.js"></script>
    <script type="text/javascript" src="../../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../js/baseUtils.js"></script>
    <script type="text/javascript" src="../../../js/LawUtils.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

<div id="header"></div>
<div class="layui-form">
    <table class="layui-table">
        <colgroup>
            <col width="150">
            <col width="150">
            <col width="200">
            <col>
        </colgroup>
        <thead>
        <tr>
            <th>房间号</th>
            <th>咨询标题</th>
            <th>咨询类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td id="room"></td>
            <td id="title"></td>
            <td id="tag"></td>
        </tr>
        </tbody>
    </table>
</div>
<div class="layui-container">
    <div class="layui-col-md9">
        <label><h2 style="color: #009E94">咨询内容：</h2></label>
        <div class="layui-form-item" id="question"
             style="white-space:normal; word-break:break-all; word-wrap:break-word; ">

        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-row">
            <div class="layui-col-md3">
                <button class="layui-btn" lay-submit id="connserver" lay-filter="connserver"
                        lay-filter="connserver">Connect Sig Server
                </button>
            </div>
            <div class="layui-col-md3">
                <button class="layui-btn layui-input-block" lay-submit id="leave" lay-filter="leave" disabled>Leave
                </button>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-col-md5">
            <h2>Local:</h2>
            <video id="localvideo" width="320" height="240" autoplay playsinline></video>
        </div>
        <div class="layui-col-md7">
            <h2>content:</h2>
            <textarea disabled id="output" rows="10" cols="50"></textarea>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-col-md5">
            <h2>Remote:</h2>
            <video id="remotevideo" width="320" height="240" autoplay playsinline></video>
        </div>
        <div class="layui-col-md7">
            <h2>Input:</h2>
            <textarea disabled id="input" rows="3" cols="50"></textarea>
        </div>
        <button id="send" disabled >Send</button>
    </div>
</div>
</div>

</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
<script src="../js/adapter-latest.js"></script>
<script src="../js/client.js"></script>


<script>
    //Demo
    layui.use(['form', 'layer', 'tree', 'util'], function () {
        $ = layui.jquery;
        var form = layui.form, layer = layui.layer;


        //获取url参数
        function GetRequest() {
            var url = decodeURI(location.search); //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        //获取tag  留言的类型
        var id = GetRequest()['id'];
        //获取pid  留言记录父id
        var room = GetRequest()['room'];
        //获取id
        var question = GetRequest()['question'];
        //获取uid
        var title = GetRequest()['title'];
        //获取uid
        var tag = GetRequest()['tag'];
        document.getElementById('title').innerHTML = title;
        document.getElementById('room').innerHTML = room;
        document.getElementById('question').innerHTML = question;
        if (tag == 1) {
            document.getElementById('tag').innerHTML = "法律咨询";
        } else if (tag == 2) {
            document.getElementById('tag').innerHTML = "法律援助";
        } else if (tag == 3) {
            document.getElementById('tag').innerHTML = "司法救助";
        }
        //监听connect
        form.on('submit(connserver)', function (data) {
            connSignalServer(room, "管理员");
        });

        //监听connect
        form.on('submit(leave)', function (obj) {
            console.log(obj);
            let a = $("#output");
            let value = $("#output")[0].value;
            console.log(a);
            var lawHelpMessage = {};
            lawHelpMessage.content = value;
            lawHelpMessage.id = id;
            lawHelpMessage = JSON.stringify(lawHelpMessage);
            $.ajax({
                url: path + "/law/help/video/update.do",
                type: "post",
                data: {"request": lawHelpMessage},
                dataType: "json",
                success: function (data) {
                    if (data == true) {
                        layer.msg("咨询内容保存成功", {icon: 6, time: 1000}, function () {
                            window.location.reload();
                        });
                    } else {
                        layer.msg("咨询内容保存失败", {icon: 6});
                    }
                }
            });
        });

    });
</script>
</body>
</html>