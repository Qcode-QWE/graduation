<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>智慧军检</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../../res/layui/css/layui.css">
  <link rel="stylesheet" href="../../../res/css/global.css">
  <script type="text/javascript" src="../../../res/layui/jquery.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="../../../res/js/baseUtils.js" charset="utf-8"></script>
</head>
<body>
<div id="header"></div>

<div class="layui-container">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="fly-panel">
        <div class="fly-panel-title fly-filter" id="law_library_type_list"></div>
        <ul class="fly-list" id="law_library_list"></ul>
        <div style="text-align: center">
          <div id="page">
          </div>
        </div>
      </div>

    </div>
    <div class="layui-col-md4">

      <div class="fly-panel">
        <h3 class="fly-panel-title">温馨通道</h3>
        <ul class="fly-panel-main fly-list-static">
          <li>
            <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
          </li>
          <li>
            <a href="http://fly.layui.com/jie/5366/" target="_blank">
              layui 常见问题的处理和实用干货集锦
            </a>
          </li>
          <li>
            <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
          </li>
          <li>
            <a href="http://fly.layui.com/jie/5366/" target="_blank">
              layui 常见问题的处理和实用干货集锦
            </a>
          </li>
          <li>
            <a href="http://fly.layui.com/jie/4281/" target="_blank">layui 的 GitHub 及 Gitee (码云) 仓库，欢迎Star</a>
          </li>
        </ul>
      </div>


      <div class="fly-panel">
        <div class="fly-panel-title">
          这里可作为广告区域
        </div>
        <div class="fly-panel-main">
          <a href="" target="_blank" class="fly-zanzhu" style="background-color: #393D49;">虚席以待</a>
        </div>
      </div>

      <div class="fly-panel fly-link">
        <h3 class="fly-panel-title">友情链接</h3>
        <dl class="fly-panel-main">
          <dd><a href="http://www.layui.com/" target="_blank">layui</a><dd>
          <dd><a href="http://layim.layui.com/" target="_blank">WebIM</a><dd>
          <dd><a href="http://layer.layui.com/" target="_blank">layer</a><dd>
          <dd><a href="http://www.layui.com/laydate/" target="_blank">layDate</a><dd>
          <dd><a href="mailto:xianxin@layui-inc.com?subject=%E7%94%B3%E8%AF%B7Fly%E7%A4%BE%E5%8C%BA%E5%8F%8B%E9%93%BE" class="fly-link">申请友链</a><dd>
        </dl>
      </div>

    </div>
  </div>
</div>

<div id="footer"></div>

<!-- 加载头部和尾部 -->
<script>
  $("#header").load("../../header.html");
  $("#footer").load("../../footer.html");
</script>
 
<script src="../../../res/layui/layui.js"></script>


<script>
  var current_type_id=0;//记录当前的新闻分类的id，用于定位当前显示的是什么新闻类型
  layui.use(['jquery','laytpl','laypage'], function(){
    var laytpl = layui.laytpl;
    $ = layui.jquery;
    var laypage = layui.laypage;


    /*获取法务知识分类信息*/
    $.ajax({
      //请求方式
      type : "GET",
      //请求地址
      url : path+'/law/type/list.do',
      datatype:"json",
      //请求成功
      success : function(res){
        current_type_id=res.data.list[0].id;//初始化当前法务知识分类id
        /*将法务知识分类列表的详细信息嵌入*/
        var getTpl = law_library_type_list_tpl.innerHTML
                ,view = document.getElementById('law_library_type_list');
        laytpl(getTpl).render(res.data.list, function(html){
          view.innerHTML = html;
        });
        getLawLibraryList(current_type_id,1,10);//初始化法务知识列表
      }
    });

    /*查询法务知识列表*/
    window.getLawLibraryList=function(id,currPage,pageSize){
      current_type_id=id;//记录当前法务知识分类
      $.ajax({
        //请求方式
        type : "POST",
        //请求地址
        url : path+'/law/library/Page.do',
        //数据参数，json字符串
        data : {
          currentPage:currPage,
          pageSize:pageSize,
          typeId:id
        },
        datatype:"json",
        //请求成功
        success : function(res){
          console.log(res.data.law_library.total);
          var data=[];//初始化返回数据
          var lawLibraryInfos=res.data.law_library.list;//得到所有法务知识信息
          var lawTypes=res.data.law_type;//得到法务知识信息的类型信息
          //遍历法务知识
          for(var i in lawLibraryInfos){
            var lawLibraryInfo=lawLibraryInfos[i];//得到一条法务知识
            var lawType=lawTypes[lawLibraryInfo.law_type_id];//得到法务知识信息对应的类型的信息
            if(null != lawType){
              type={"type":lawType.title};
            }
            $.extend(lawLibraryInfo, type);//对象合并
            data.push(lawLibraryInfo);
          }
          /*将法务知识列表的详细信息嵌入*/
          var getTpl = law_library_list_tpl.innerHTML
                  ,view = document.getElementById('law_library_list');
          laytpl(getTpl).render(data, function(html){
            view.innerHTML = html;
          });

          //分页信息
          laypage.render({
            elem: 'page'//嵌入id='page'的标签元素
            , count: res.data.law_library.total      //记录总数
            , layout: ['prev', 'page', 'next','limit','refresh','skip']
            , limit: pageSize                 //每页记录数
            , curr: currPage                  //当前页
            , groups: 5                      //连续页码个数
            , prev: '上一页'                 //上一页文本
            , next: '下一页'                 //下一页文本
            , first: '首页'                  //首页文本
            , last: "尾页"                   //尾页文本
            , limits: [5,10,15]
            , jump: function (obj,first) {   //切换分页的回调函数
              if(!first){ //（是否首次，一般用于初始加载的判断）
                getLawLibraryList(current_type_id,obj.curr,obj.limit);
              }
            }
          });
        }
      });
    };


  });

</script>

<!--法务知识分类信息列表模板-->
<script id="law_library_type_list_tpl" type="text/html">
  {{# layui.each(d, function(index, item){ }}
    {{# if(item.id==current_type_id){ }}
      <a href="javascript:void(0)" class="layui-this" onclick="getLawLibraryList({{item.id}},1,10)">{{item.title}}</a>
    {{# }else{ }}
      <a href="javascript:void(0)" onclick="getLawLibraryList({{item.id}},1,10)">{{item.title}}</a>
    {{# } }}
    <span class="fly-mid"></span>
  {{# }); }}
</script>

<script id="law_library_list_tpl" type="text/html">
  {{# layui.each(d, function(index, item){ }}
  <li>
    <div style="position: absolute; left: 15px; top: 15px;">
      <h2>
        <a class="layui-badge">{{item.type}}</a>
        <a href="/app/view/law/library/law-library-detail.html?id={{item.id}}">{{item.title}}</a>
      </h2>
      <div class="fly-list-info">
          <span>
            闲心<i class="layui-icon" style="color: orange">&#xe770;</i>
          </span>

        <!--将时间戳格式化-->
        {{#
        if (CheckIsNullOrEmpty(item.create_time)){
        var date = new Date();
        var createTime = item.create_time+"000";
        date.setTime(createTime);
        var t = date.Format("yyyy-MM-dd hh:mm:ss");
        }}
        <span>{{ t }}</span>
        {{#
        }else {
        }}
        <span>no time</span>
        {{#
        }
        }}

      </div>
    </div>
    <span style="position: absolute;right: 15px;bottom: 15px">
            <i class="layui-icon">&#xe705;</i> {{item.read}}
      </span>
  </li>
  {{#  }); }}
</script>

</body>
</html>